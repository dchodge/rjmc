<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Example 1: Mixture model • rjmc</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Example 1: Mixture model">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rjmc</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Ex1_mixture.html">Example 1: Mixture model</a>
    </li>
    <li>
      <a href="../articles/Ex2_seir_attack_rate.html">Example 2: SEIR change-point attack rate</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Example 1: Mixture model</h1>
                        <h4 data-toc-skip class="author">David
Hodgson</h4>
            
            <h4 data-toc-skip class="date">2025-08-13</h4>
      

      <div class="hidden name"><code>Ex1_mixture.Rmd</code></div>

    </div>

    
    
<p>This markdown block outlines a simulation study designed to
demonstrate how RJMCMC can be used to recover the parameters of a
<strong>mixture model</strong>. Here’s what it does:</p>
<ul>
<li>
<strong>Purpose:</strong> Highlight the ability of RJMCMC to
estimate parameters and select the number of components in a mixture
model.</li>
<li>
<strong>Steps:</strong> Systematically define the target
distribution, simulate data, apply RJMCMC, and analyze the results.</li>
<li>
<strong>RJMCMC Role:</strong> It enables the model to explore
variable-dimensional parameter spaces (different
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>)
while estimating component parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>μ</mi><mi>k</mi></msub><mo>,</mo><msub><mi>σ</mi><mi>k</mi></msub><mo>,</mo><msub><mi>π</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(\mu_k, \sigma_k, \pi_k)</annotation></semantics></math>.</li>
</ul>
<p>This block serves as a guide for implementing and understanding
RJMCMC in the context of mixture model recovery. If you’d like, I can
help add technical details or coding snippets to complement it!</p>
<p><a href="https://people.maths.bris.ac.uk/~mapjg/papers/RichardsonGreenRSSB.pdf" class="external-link">Link
to methods</a></p>
<div class="section level2">
<h2 id="relevant-packages">1. Relevant packages<a class="anchor" aria-label="anchor" href="#relevant-packages"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/load_all.html" class="external-link">load_all</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mjskay.github.io/tidybayes/" class="external-link">tidybayes</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mjskay.github.io/ggdist/" class="external-link">ggdist</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Using more than one core might fail on windows, </span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">.Platform</span><span class="op">$</span><span class="va">OS.type</span> <span class="op">==</span> <span class="st">"windows"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">mc.cores</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">mc.cores</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># use as many as available, preferably 4.</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simulated-data">2. Simulated data<a class="anchor" aria-label="anchor" href="#simulated-data"></a>
</h2>
<p>We aim to recover the parameters of a mixture distribution using
Reversible Jump Markov Chain Monte Carlo (RJMCMC). The target mixture
distribution is defined as follows:</p>
<ul>
<li>Mixture of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>
Gaussian components.</li>
<li>Each component has:
<ul>
<li>Mean
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>μ</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\mu_k</annotation></semantics></math>).</li>
<li>Standard deviation
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>σ</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\sigma_k</annotation></semantics></math>).</li>
<li>Mixing proportion
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>π</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\pi_k</annotation></semantics></math>).</li>
</ul>
</li>
<li><h3 id="key-parameters">2.1 <strong>Key
Parameters</strong>
</h3></li>
</ul>
<ol style="list-style-type: decimal">
<li>
<strong><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>:
Number of Components</strong>
<ul>
<li>Inferred during the RJMCMC process.</li>
<li>Represented indirectly as the number of columns in the
<code>jump</code> matrix.</li>
<li>Birth and death proposals dynamically add or remove components.</li>
</ul>
</li>
<li>
<strong><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>σ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>:
Standard Deviation</strong>
<ul>
<li>Represents the standard deviation for each Gaussian component.</li>
<li>Sampled and updated during the RJMCMC steps.</li>
<li>Plays a role in the likelihood evaluation through
<code>dnorm</code>.</li>
</ul>
</li>
<li>
<strong><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>:
Mean</strong>
<ul>
<li>Represents the mean of each Gaussian component.</li>
<li>Sampled and updated during the RJMCMC steps.</li>
<li>Guides the location of the mixture components.</li>
</ul>
</li>
<li>
<strong><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>:
Mixing Proportions</strong>
<ul>
<li>Determines the weight of each Gaussian component in the
mixture.</li>
<li>Constrained to sum to 1, handled during proposals (e.g.,
<code>sampleBirthProposal</code>).</li>
</ul>
</li>
</ol>
<p>Therefore, we simulate a dataset from a predefined mixture model with
known parameters
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo>,</mo><msub><mi>μ</mi><mi>k</mi></msub><mo>,</mo><msub><mi>σ</mi><mi>k</mi></msub><mo>,</mo><msub><mi>π</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">K, \mu_k, \sigma_k, \pi_k</annotation></semantics></math>).
Here,</p>
<ul>
<li>K = 3</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>μ</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\mu_k</annotation></semantics></math>
= 2, 6, 12</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>σ</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\sigma_k</annotation></semantics></math>
= 1, 0.5, 1</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>π</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\pi_k</annotation></semantics></math>
= 0.3, 0.7, 1</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="co"># Run the model </span></span>
<span><span class="va">obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">10e4</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fl">30</span> <span class="op">*</span> <span class="va">m</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">10e4</span>, <span class="fl">6</span>, <span class="fl">0.5</span><span class="op">)</span>, <span class="fl">70</span> <span class="op">*</span> <span class="va">m</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">10e4</span>, <span class="fl">12</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fl">100</span> <span class="op">*</span> <span class="va">m</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span>, bins <span class="op">=</span> <span class="fl">30</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Value"</span>, y <span class="op">=</span> <span class="st">"Frequency"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Ex1_mixture_files/figure-html/unnamed-chunk-2-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="simulation-recovery">3. Simulation recovery<a class="anchor" aria-label="anchor" href="#simulation-recovery"></a>
</h2>
<div class="section level3">
<h3 id="description-of-the-model">3.1 Description of the model<a class="anchor" aria-label="anchor" href="#description-of-the-model"></a>
</h3>
<p>The model represents a <strong>Gaussian mixture distribution</strong>
with the following key components:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Mixture Structure</strong>:
<ul>
<li>The distribution is a combination of multiple Gaussian
components.</li>
<li>Each component is defined by its:
<ul>
<li>Mean
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>μ</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\mu_k</annotation></semantics></math>).</li>
<li>Standard deviation
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>σ</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\sigma_k</annotation></semantics></math>).</li>
<li>Mixing proportion
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mi>k</mi></msub><annotation encoding="application/x-tex">p_k</annotation></semantics></math>).</li>
</ul>
</li>
</ul>
</li>
<li>
<strong>Mathematical Representation</strong>:
<ul>
<li>The probability density function for an observation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math>
is given by:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><munderover><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>K</mi></munderover><msub><mi>p</mi><mi>k</mi></msub><mo>⋅</mo><mi>𝒩</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>∣</mo><msub><mi>μ</mi><mi>k</mi></msub><mo>,</mo><msubsup><mi>σ</mi><mi>k</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
p(z) = \sum_{k=1}^K p_k \cdot \mathcal{N}(z \mid \mu_k, \sigma_k^2)
</annotation></semantics></math> where:
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝒩</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mo>∣</mo><msub><mi>μ</mi><mi>k</mi></msub><mo>,</mo><msubsup><mi>σ</mi><mi>k</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{N}(z \mid \mu_k, \sigma_k^2)</annotation></semantics></math>
is the normal density for the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>-th
component.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mi>k</mi></msub><annotation encoding="application/x-tex">p_k</annotation></semantics></math>
represents the mixing proportion of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>-th
component.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>
is the number of components.</li>
</ul>
</li>
</ul>
</li>
<li>
<strong>Parameters to Infer</strong>:
<ul>
<li>
<strong><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math></strong>:
The number of mixture components, which is inferred dynamically using
RJMCMC.</li>
<li>
<strong><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mi>k</mi></msub><annotation encoding="application/x-tex">p_k</annotation></semantics></math></strong>:
Mixing proportions, constrained such that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>K</mi></msubsup><msub><mi>p</mi><mi>k</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\sum_{k=1}^K p_k = 1</annotation></semantics></math>.</li>
<li>
<strong><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>μ</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\mu_k</annotation></semantics></math></strong>:
Means of the components, defining their location.</li>
<li>
<strong><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>σ</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\sigma_k</annotation></semantics></math></strong>:
Standard deviations, defining their spread.</li>
</ul>
</li>
<li>
<strong>Dynamic Nature of the Model</strong>:
<ul>
<li>The number of components
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>)
is not fixed and can change as the algorithm proposes and evaluates
birth or death moves.</li>
<li>This allows the model to adaptively determine the most probable
number of components based on the observed data.</li>
</ul>
</li>
<li>
<strong>Likelihood Function</strong>:
<ul>
<li>The likelihood of the data given the parameters is:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ℒ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">data</mtext><mo>∣</mo><mi>K</mi><mo>,</mo><mo stretchy="false" form="prefix">{</mo><msub><mi>p</mi><mi>k</mi></msub><mo>,</mo><msub><mi>μ</mi><mi>k</mi></msub><mo>,</mo><msub><mi>σ</mi><mi>k</mi></msub><mo stretchy="false" form="postfix">}</mo><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><munderover><mo>∏</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><mrow><mo stretchy="true" form="prefix">(</mo><munderover><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>K</mi></munderover><msub><mi>p</mi><mi>k</mi></msub><mo>⋅</mo><mi>𝒩</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>z</mi><mi>i</mi></msub><mo>∣</mo><msub><mi>μ</mi><mi>k</mi></msub><mo>,</mo><msubsup><mi>σ</mi><mi>k</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\mathcal{L}(\text{data} \mid K, \{p_k, \mu_k, \sigma_k\}) = \prod_{i=1}^N \left( \sum_{k=1}^K p_k \cdot \mathcal{N}(z_i \mid \mu_k, \sigma_k^2) \right)
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>
is the total number of data points.</li>
</ul>
</li>
<li>
<strong>Prior Assumptions</strong>:
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mi>k</mi></msub><annotation encoding="application/x-tex">p_k</annotation></semantics></math>:
Uniform distribution over the simplex.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>μ</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\mu_k</annotation></semantics></math>:
Uniform distribution over a predefined range (e.g., [0, 20]).</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>σ</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\sigma_k</annotation></semantics></math>:
Uniform distribution over a positive range (e.g., [0.3, 3]).</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>:
Uniform prior over a predefined integer range (e.g., [1, 8]).</li>
</ul>
</li>
</ol>
<p>This model structure allows the RJMCMC algorithm to infer both the
number of components and their parameters, effectively capturing the
complexity of the underlying data distribution.</p>
</div>
<div class="section level3">
<h3 id="steps-to-recover-k-mu-p-sigma">3.2 Steps to Recover
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>K</mi><mo>,</mo><mi>μ</mi><mo>,</mo><mi>p</mi><mo>,</mo><mi>σ</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(K, \mu, p, \sigma)</annotation></semantics></math>:<a class="anchor" aria-label="anchor" href="#steps-to-recover-k-mu-p-sigma"></a>
</h3>
<div class="section level4">
<h4 id="initialization-functions">
<strong>1. Initialization Functions</strong><a class="anchor" aria-label="anchor" href="#initialization-functions"></a>
</h4>
<ul>
<li>
<strong><code>sampleInitPrior</code></strong>:
<ul>
<li>Samples the initial value for the parameter (e.g.,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>σ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>).</li>
</ul>
</li>
<li>
<strong><code>sampleInitJump</code></strong>:
<ul>
<li>Initializes the <code>jump</code> matrix, representing the mixture
parameters:
<ul>
<li>First row: mixing proportions
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>.</li>
<li>Second row: means
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>.</li>
<li>Third row: standard deviations
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>σ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>.</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section level4">
<h4 id="prior-and-likelihood-evaluations">
<strong>2. Prior and Likelihood Evaluations</strong><a class="anchor" aria-label="anchor" href="#prior-and-likelihood-evaluations"></a>
</h4>
<ul>
<li>
<strong><code>evaluateLogPrior</code></strong>:
<ul>
<li>Computes the log-prior probability for all parameters.</li>
<li>Ensures parameters like
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>,</mo><mi>μ</mi><mo>,</mo><mi>σ</mi></mrow><annotation encoding="application/x-tex">p, \mu, \sigma</annotation></semantics></math>
are within their respective bounds.</li>
<li>Includes a uniform prior for the number of components
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>).</li>
</ul>
</li>
<li>
<strong><code>evaluateLogLikelihood</code></strong>:
<ul>
<li>Computes the log-likelihood of the data given the current parameter
values.</li>
<li>Uses the Gaussian mixture model equation:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mo>=</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>N</mi><mtext mathvariant="normal">data</mtext></msub></munderover><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>K</mi></munderover><msub><mi>p</mi><mi>j</mi></msub><mo>⋅</mo><mi>𝒩</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>z</mi><mi>i</mi></msub><mo>∣</mo><msub><mi>μ</mi><mi>j</mi></msub><mo>,</mo><msub><mi>σ</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
L = \sum_{i=1}^{N_{\text{data}}} \log\left(\sum_{j=1}^K p_j \cdot \mathcal{N}(z_i \mid \mu_j, \sigma_j)\right)
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math>
is the observed data.</li>
</ul>
</li>
</ul>
</div>
<div class="section level4">
<h4 id="birth-and-death-proposals">
<strong>3. Birth and Death Proposals</strong><a class="anchor" aria-label="anchor" href="#birth-and-death-proposals"></a>
</h4>
<ul>
<li>
<strong><code>sampleBirthProposal</code></strong>:
<ul>
<li>Adds a new component by sampling:
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>:
a new mixing proportion.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>:
a new mean.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>σ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>:
a new standard deviation.</li>
</ul>
</li>
<li>Adjusts existing
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
values to ensure they sum to 1.</li>
</ul>
</li>
<li>
<strong><code>sampleDeathProposal</code></strong>:
<ul>
<li>Removes a randomly selected component.</li>
<li>Adjusts the remaining
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
values to maintain normalization.</li>
</ul>
</li>
<li>
<strong><code>evaluateBirthProposal</code></strong>:
<ul>
<li>Evaluates the probability of proposing a new component.</li>
</ul>
</li>
<li>
<strong><code>evaluateDeathProposal</code></strong>:
<ul>
<li>Evaluates the probability of proposing to remove a component.</li>
</ul>
</li>
</ul>
</div>
<div class="section level4">
<h4 id="jump-and-proposal-sampling">
<strong>4. Jump and Proposal Sampling</strong><a class="anchor" aria-label="anchor" href="#jump-and-proposal-sampling"></a>
</h4>
<ul>
<li>
<strong><code>sampleJump</code></strong>:
<ul>
<li>Updates the parameters of a specific component:
<ul>
<li>Adjusts
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>,</mo><mi>μ</mi><mo>,</mo><mi>σ</mi></mrow><annotation encoding="application/x-tex">p, \mu, \sigma</annotation></semantics></math>
for the selected component.</li>
<li>Introduces small random changes.</li>
</ul>
</li>
</ul>
</li>
<li>
<strong><code>sampleProposal</code></strong>:
<ul>
<li>Decides whether to perform a birth, death, or jump move.</li>
<li>Probabilities vary depending on the current number of
components.</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="overall-process-in-rjmcmc">
<strong>Overall Process in RJMCMC</strong><a class="anchor" aria-label="anchor" href="#overall-process-in-rjmcmc"></a>
</h3>
<ol style="list-style-type: decimal">
<li>
<strong>Initialization</strong>:
<ul>
<li>Start with initial values for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>σ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>
and the <code>jump</code> matrix.</li>
</ul>
</li>
<li>
<strong>Proposal Steps</strong>:
<ul>
<li>Select a move type (birth, death, or jump) based on
<code>sampleProposal</code>.</li>
<li>Apply the corresponding function (e.g.,
<code>sampleBirthProposal</code>).</li>
</ul>
</li>
<li>
<strong>Evaluation</strong>:
<ul>
<li>Compute the prior and likelihood for the proposed parameters.</li>
<li>Use the Metropolis-Hastings acceptance rule to decide whether to
accept or reject the proposal.</li>
</ul>
</li>
<li>
<strong>Iteration</strong>:
<ul>
<li>Repeat steps to explore the posterior distribution of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>σ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>.</li>
</ul>
</li>
</ol>
<hr>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span></span>
<span>  lowerParSupport_fitted <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">8</span><span class="op">)</span>,</span>
<span>  upperParSupport_fitted <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8</span><span class="op">)</span>,</span>
<span></span>
<span>  namesOfParameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sigma"</span><span class="op">)</span>,</span>
<span></span>
<span>  sampleInitPrior <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">datalist</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span></span>
<span>  sampleInitJump <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">params</span>, <span class="va">datalist</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span>    <span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span></span>
<span>    <span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">jump_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">p</span>, <span class="va">mu</span>, <span class="va">sigma</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="va">jump_new</span></span>
<span>  <span class="op">}</span>,</span>
<span></span>
<span>  evaluateLogPrior <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">params</span>, <span class="va">jump</span>, <span class="va">datalist</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">params</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">0</span>, <span class="fl">1</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">p_vec</span> <span class="op">&lt;-</span> <span class="va">jump</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span></span>
<span>    <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">p_vec</span><span class="op">)</span> <span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">p</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">dunif</a></span><span class="op">(</span><span class="va">p_vec</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fl">0</span>, <span class="fl">1</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">mu_vec</span> <span class="op">&lt;-</span> <span class="va">jump</span><span class="op">[</span><span class="fl">2</span>, <span class="op">]</span></span>
<span>    <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mu_vec</span><span class="op">)</span> <span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">p</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">dunif</a></span><span class="op">(</span><span class="va">mu_vec</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fl">0</span>, <span class="fl">20</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">sigma_vec</span> <span class="op">&lt;-</span> <span class="va">jump</span><span class="op">[</span><span class="fl">3</span>, <span class="op">]</span></span>
<span>    <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sigma_vec</span><span class="op">)</span> <span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">p</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">dunif</a></span><span class="op">(</span><span class="va">sigma_vec</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fl">0.3</span>, <span class="fl">3</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">jump</span><span class="op">)</span></span>
<span>    <span class="va">p</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">dunif</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">1</span>, <span class="fl">8</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">#  cat("prior: ", str(p))</span></span>
<span>    <span class="va">p</span></span>
<span>  <span class="op">}</span>,</span>
<span></span>
<span>  evaluateLogLikelihood <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">params</span>, <span class="va">jump</span>, <span class="va">datalist</span><span class="op">)</span> <span class="op">{</span></span>
<span>   <span class="co"># cat("in:  evaluateLogLikelihood")</span></span>
<span>    <span class="va">ll</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>    <span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">jump</span><span class="op">)</span></span>
<span>    <span class="va">p_vec</span> <span class="op">&lt;-</span> <span class="va">jump</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span></span>
<span></span>
<span>    <span class="va">mu_vec</span> <span class="op">&lt;-</span> <span class="va">jump</span><span class="op">[</span><span class="fl">2</span>, <span class="op">]</span></span>
<span>    <span class="va">sigma_vec</span> <span class="op">&lt;-</span> <span class="va">jump</span><span class="op">[</span><span class="fl">3</span>, <span class="op">]</span></span>
<span></span>
<span>    <span class="va">z</span> <span class="op">&lt;-</span> <span class="va">datalist</span><span class="op">$</span><span class="va">obs</span></span>
<span>    <span class="va">N_data</span> <span class="op">&lt;-</span> <span class="va">datalist</span><span class="op">$</span><span class="va">N_data</span></span>
<span>    <span class="va">sigma</span> <span class="op">&lt;-</span> <span class="va">params</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">N_data</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">i_x</span> <span class="op">=</span> <span class="fl">0</span></span>
<span>        <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">i_x</span> <span class="op">&lt;-</span> <span class="va">i_x</span> <span class="op">+</span> <span class="va">p_vec</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">z</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">mu_vec</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, <span class="va">sigma_vec</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="va">ll</span> <span class="op">&lt;-</span> <span class="va">ll</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">i_x</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>   <span class="co"># cat("loglik: ", str(ll) )</span></span>
<span>    <span class="va">ll</span></span>
<span>  <span class="op">}</span>,</span>
<span></span>
<span>  sampleBirthProposal <span class="op">=</span>  <span class="kw">function</span><span class="op">(</span><span class="va">params</span>, <span class="va">jump</span>, <span class="va">i_idx</span>, <span class="va">datalist</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">p_new_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">p_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">jump</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">p_new_sample</span><span class="op">)</span>, <span class="va">p_new_sample</span><span class="op">)</span></span>
<span>    <span class="va">mu_new_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">20</span><span class="op">)</span></span>
<span>    <span class="va">mu_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">jump</span><span class="op">[</span><span class="fl">2</span>, <span class="op">]</span>, <span class="va">mu_new_sample</span><span class="op">)</span></span>
<span>    <span class="va">sigma_new_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.3</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>    <span class="va">sigma_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">jump</span><span class="op">[</span><span class="fl">3</span>, <span class="op">]</span>, <span class="va">sigma_new_sample</span><span class="op">)</span></span>
<span>    <span class="va">jump_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">p_new</span>, <span class="va">mu_new</span>, <span class="va">sigma_new</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="va">jump_new</span></span>
<span>  <span class="op">}</span>,</span>
<span></span>
<span>  sampleDeathProposal <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">params</span>, <span class="va">jump</span>, <span class="va">i_idx</span>, <span class="va">datalist</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>    <span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">jump</span><span class="op">)</span></span>
<span>    <span class="va">jump_remove</span> <span class="op">&lt;-</span> <span class="va">jump</span><span class="op">[</span>, <span class="va">i_idx</span><span class="op">]</span></span>
<span>    <span class="va">jump_new</span> <span class="op">&lt;-</span> <span class="va">jump</span><span class="op">[</span>, <span class="op">-</span><span class="va">i_idx</span><span class="op">]</span></span>
<span>    <span class="va">jump_new</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">jump_new</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">jump_remove</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">jump_new</span></span>
<span>  <span class="op">}</span>,</span>
<span></span>
<span>  evaluateBirthProposal <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">params</span>, <span class="va">jump</span>, <span class="va">i_idx</span>, <span class="va">datalist</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>    <span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">jump</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="va">N</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">dunif</a></span><span class="op">(</span><span class="va">jump</span><span class="op">[</span><span class="fl">2</span>, <span class="va">N</span><span class="op">]</span>, <span class="fl">0</span>, <span class="fl">20</span> <span class="op">)</span> <span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span></span>
<span>  evaluateDeathProposal <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">params</span>, <span class="va">jump</span>, <span class="va">i_idx</span>, <span class="va">datalist</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>    <span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">jump</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="op">(</span><span class="va">N</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">dunif</a></span><span class="op">(</span><span class="va">jump</span><span class="op">[</span><span class="fl">2</span>, <span class="va">i_idx</span><span class="op">]</span>, <span class="fl">0</span>, <span class="fl">20</span> <span class="op">)</span> <span class="op">)</span> </span>
<span>  <span class="op">}</span>,</span>
<span></span>
<span>  sampleJump <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">params</span>, <span class="va">jump</span>, <span class="va">i_idx</span>, <span class="va">datalist</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>    <span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">jump</span><span class="op">)</span></span>
<span>    <span class="va">jump_update</span> <span class="op">&lt;-</span> <span class="va">jump</span><span class="op">[</span>, <span class="va">i_idx</span><span class="op">]</span></span>
<span></span>
<span>    <span class="va">p_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">jump_update</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0.01</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">diff</span> <span class="op">=</span> <span class="op">(</span><span class="va">jump_update</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">p_new</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">N</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">p_new_vew</span> <span class="op">&lt;-</span> <span class="va">jump</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span> <span class="op">+</span> <span class="va">diff</span></span>
<span>    <span class="va">p_new_vew</span><span class="op">[</span><span class="va">i_idx</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">p_new</span></span>
<span>    <span class="va">jump</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">p_new_vew</span></span>
<span></span>
<span>    <span class="va">jump</span><span class="op">[</span><span class="fl">2</span>, <span class="va">i_idx</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">jump_update</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span>    <span class="va">jump</span><span class="op">[</span><span class="fl">3</span>, <span class="va">i_idx</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">jump_update</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span>, <span class="fl">0.3</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">jump</span></span>
<span>  <span class="op">}</span>,</span>
<span></span>
<span>  sampleProposal <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">params</span>, <span class="va">jump</span>, <span class="va">datalist</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">jump</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">N</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="fl">0.67</span>, <span class="fl">1.0</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">N</span> <span class="op">==</span> <span class="fl">20</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.33</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.33</span>, <span class="fl">0.67</span>, <span class="fl">1.0</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">q</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="settings-and-run-model">3.3. Settings and run model<a class="anchor" aria-label="anchor" href="#settings-and-run-model"></a>
</h3>
<p>This code block defines the settings for the RJMCMC algorithm,
prepares the input data, executes the model, and saves the results.
Below is a breakdown of its components:</p>
<div class="section level4">
<h4 id="define-settings">
<strong>1. Define Settings</strong><a class="anchor" aria-label="anchor" href="#define-settings"></a>
</h4>
<p>The <code>settings</code> list specifies the configuration for the
RJMCMC run:</p>
<ul>
<li>
<strong><code>numberChainRuns</code></strong>: Specifies the number
of independent MCMC chains to run (e.g., 4 chains).</li>
<li>
<strong><code>numberCores</code></strong>: Indicates the number of
CPU cores allocated for computation. Parallel processing is possible if
<code>runParallel = TRUE</code>.</li>
<li>
<strong><code>iterations</code></strong>: Sets the total number of
iterations for each MCMC chain (e.g., 4000 iterations).</li>
<li>
<strong><code>burninPosterior</code></strong>: Defines the number of
initial iterations to discard as burn-in (e.g., 2000 iterations).</li>
<li>
<strong><code>thin</code></strong>: Thinning interval to reduce
autocorrelation by retaining only every
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>-th
sample (e.g., every 10th sample).</li>
<li>
<strong><code>runParallel</code></strong>: Boolean flag controlling
whether chains are run in parallel (<code>FALSE</code> here indicates
sequential execution).</li>
<li>
<strong><code>onDebug</code></strong>: Boolean flag for enabling
debugging mode, which can output additional information during
execution.</li>
</ul>
<hr>
</div>
<div class="section level4">
<h4 id="prepare-data">
<strong>2. Prepare Data</strong><a class="anchor" aria-label="anchor" href="#prepare-data"></a>
</h4>
<p>The <code>data_l</code> list structures the observed data for use in
the RJMCMC function: - <strong><code>obs</code></strong>: A vector
containing the observed data points, likely representing samples drawn
from an unknown mixture distribution. -
<strong><code>N_data</code></strong>: The total number of observations,
calculated as the length of the <code>obs</code> vector.</p>
<p>This organized format ensures compatibility with the
<code>rjmc_func</code> function.</p>
<hr>
</div>
<div class="section level4">
<h4 id="run-the-model">
<strong>3. Run the Model</strong><a class="anchor" aria-label="anchor" href="#run-the-model"></a>
</h4>
<p>The <code>rjmc_func</code> function executes the RJMCMC algorithm
using: - <strong><code>model</code></strong>: The previously defined
RJMCMC model, containing prior distributions, likelihood functions, and
proposal mechanisms. - <strong><code>data_l</code></strong>: The
structured data list, providing the observed values and their count. -
<strong><code>settings</code></strong>: The configuration for the MCMC
run.</p>
<p>The output, stored in the <code>outputs</code> object, contains the
results of the RJMCMC process, including posterior samples and
diagnostics for the model parameters.</p>
<hr>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define the settings</span></span>
<span><span class="va">settings</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    numberCores <span class="op">=</span> <span class="va">mc.cores</span>,</span>
<span>    numberChainRuns <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    iterations <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>    burninPosterior <span class="op">=</span> <span class="fl">5000</span>,</span>
<span>    thin <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    obs <span class="op">=</span> <span class="va">obs</span>,</span>
<span>    N_data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">obs</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">outputs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rjmc_func.html">rjmc_func</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">data_l</span>, <span class="va">settings</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">outputs</span>, <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org/reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"outputs"</span>, <span class="st">"fits"</span>, <span class="st">"mixture_norm"</span>, <span class="st">"fit_sim_null.RDS"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="analyse-the-posterior-distributions">4. Analyse the posterior distributions<a class="anchor" aria-label="anchor" href="#analyse-the-posterior-distributions"></a>
</h2>
<p>This section examines the posterior distributions generated by the
RJMCMC algorithm. We aim to evaluate the ability of the model to recover
key parameters of the mixture distribution, such as the number of
components
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>),
the mixing proportions
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>),
the means
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>),
and the standard deviations
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>σ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>).</p>
<div class="section level3">
<h3 id="simulation-recovery-of-k">4.1 Simulation recovery of K<a class="anchor" aria-label="anchor" href="#simulation-recovery-of-k"></a>
</h3>
<p>In this subsection, we analyze the posterior distribution of the
number of mixture components
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>).
The posterior probabilities for different values of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>
are calculated, and the mode of the posterior distribution is compared
to the true value. The bar chart below illustrates the posterior
probabilities for the number of components, with the true value
highlighted by a red vertical line:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">n_chain</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span></span>
<span><span class="va">tables_length</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_lengths.html">get_lengths</a></span><span class="op">(</span><span class="va">outputs</span>, <span class="va">n_chain</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_K_post</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">tables_length</span><span class="op">)</span>,</span>
<span>  post <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">tables_length</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_K_post</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dim</span>, y <span class="op">=</span> <span class="va">post</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"3"</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Number of mixture components"</span>, y <span class="op">=</span> <span class="st">"Posterior probability"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Ex1_mixture_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="simulation-recovery-of-p-mu-sigma">4.2 Simulation recovery of p, mu, sigma<a class="anchor" aria-label="anchor" href="#simulation-recovery-of-p-mu-sigma"></a>
</h3>
<p>Here, we examine the posterior distributions of the mixing
proportions (p), means (μ), and standard deviations (σ) for the mixture
components. Histograms are used to visualize the posterior samples, with
the true values highlighted by red vertical lines.</p>
<p>The histograms provide insights into the precision of the RJMCMC
algorithm in recovering the true parameter values.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">posterior_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_df</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, </span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_df</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">outputs</span><span class="op">$</span><span class="va">jump</span><span class="op">[[</span><span class="va">y</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, </span>
<span>      <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">outputs</span><span class="op">$</span><span class="va">jump</span><span class="op">[[</span><span class="va">y</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">t</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="va">as.data.frame</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">arrange</span><span class="op">(</span><span class="va">V2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">mutate</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, sample <span class="op">=</span> <span class="va">x</span>, chain <span class="op">=</span> <span class="va">y</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>          <span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"p"</span>, <span class="st">"mu"</span>, <span class="st">"sigma"</span>, <span class="st">"n"</span>, <span class="st">"sample"</span>, <span class="st">"chain"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">pivot_longer</span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">sample</span>, <span class="va">chain</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"parameter"</span>, values_to <span class="op">=</span> <span class="st">"values"</span> <span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="st">"parameter"</span>, values_from <span class="op">=</span> <span class="st">"values"</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">posterior_sample</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>    </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">6</span>, <span class="fl">12</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">17</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">posterior_sample</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>    </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.15</span>, <span class="fl">0.35</span>, <span class="fl">0.5</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="va">posterior_sample</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>    </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.5</span>, <span class="fl">1</span> <span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">sigma</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">/</span> <span class="va">p2</span> <span class="op">/</span> <span class="va">p3</span></span></code></pre></div>
<p><img src="Ex1_mixture_files/figure-html/unnamed-chunk-4-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="summary-of-the-posterior-distributions">4.3 Summary of the posterior distributions<a class="anchor" aria-label="anchor" href="#summary-of-the-posterior-distributions"></a>
</h3>
<p>This subsection summarizes the posterior distributions of the mixture
model, focusing on the most probable number of components (K) and the
associated parameter values. The posterior proportions for each K are
calculated, and the posterior trajectory of parameters is visualized for
selected values of K.</p>
<p>The first plot below shows the posterior proportions for the number
of components (K). Subsequent plots visualize the posterior trajectories
for p, μ, and σ for K = 3 and K = 4.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tables_length</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_lengths.html">get_lengths</a></span><span class="op">(</span><span class="va">outputs</span>, <span class="va">n_chain</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mode_post</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">tables_length</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">mix_size</span> <span class="op">&lt;-</span> <span class="va">mode_post</span></span>
<span></span>
<span><span class="va">post_process_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_clean_posterior.html">get_clean_posterior</a></span><span class="op">(</span><span class="va">outputs</span>, <span class="st">"3"</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">post_process_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_clean_posterior.html">get_clean_posterior</a></span><span class="op">(</span><span class="va">outputs</span>, <span class="st">"4"</span>, <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prop</span> <span class="op">&lt;-</span> <span class="va">tables_length</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">tables_length</span><span class="op">)</span></span>
<span><span class="va">plotl</span> <span class="op">&lt;-</span> <span class="va">prop</span><span class="op">[</span><span class="va">mix_size</span><span class="op">]</span></span>
<span></span>
<span><span class="va">p0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">prop</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">prop</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Number of mixture components"</span>, y <span class="op">=</span> <span class="st">"Proportion of posterior distribution"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1_anot</span> <span class="op">&lt;-</span> <span class="fu">get_posterior_component_size</span><span class="op">(</span><span class="st">"3"</span>, <span class="va">tables_length</span>, <span class="va">post_process_3</span>, <span class="va">data_l</span><span class="op">)</span></span>
<span><span class="va">p2_anot</span> <span class="op">&lt;-</span> <span class="fu">get_posterior_component_size</span><span class="op">(</span><span class="st">"4"</span>, <span class="va">tables_length</span>, <span class="va">post_process_4</span>, <span class="va">data_l</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p0</span> <span class="op">/</span> <span class="va">p1_anot</span> <span class="op">/</span> <span class="va">p2_anot</span></span></code></pre></div>
<p><img src="Ex1_mixture_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
<p>This analysis highlights the posterior support for different numbers
of components and provides a detailed summary of the recovered
parameters for the most probable configurations.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by David Hodgson.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
